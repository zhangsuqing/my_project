{"remainingRequest":"E:\\workspace\\code\\test\\my_project\\node_modules\\babel-loader\\lib\\index.js!E:\\workspace\\code\\test\\my_project\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\workspace\\code\\test\\my_project\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\workspace\\code\\test\\my_project\\src\\views\\auth\\user\\edit_user.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\workspace\\code\\test\\my_project\\src\\views\\auth\\user\\edit_user.vue","mtime":1563023636938},{"path":"E:\\workspace\\code\\test\\my_project\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\workspace\\code\\test\\my_project\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\workspace\\code\\test\\my_project\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\workspace\\code\\test\\my_project\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { isMobile, isEmail } from \"@/utils/validate\";\nimport { addUser, updUser, getUserInfo // uploadPicture\n} from \"@/api/auth/user\"; // import { insertUserRole } from \"@/api/auth/roleUser\";\n\nimport { fetchRoleList } from \"@/api/auth/role\";\nimport head_Png from \"@/assets/default_head_title.png\";\nexport default {\n  props: [\"dialogStatus\", \"dialogFormVisible\"],\n  data: function data() {\n    var idValidatePhone = function idValidatePhone(rule, value, callback) {\n      if (!isMobile(value)) {\n        callback(new Error(\"请输入正确的手机号码\"));\n      } else {\n        callback();\n      }\n    };\n\n    var idValidateEmail = function idValidateEmail(rule, value, callback) {\n      if (!isEmail(value)) {\n        callback(new Error(\"请输入正确的邮箱号码\"));\n      } else {\n        callback();\n      }\n    };\n\n    return {\n      head_Png: head_Png,\n      myVisible: this.dialogFormVisible,\n      disabledInput: false,\n      imageUrl: '',\n      roleListDataList: [],\n      roleListDataByid: [],\n      checkListData: [],\n      statusMap: {\n        create: \"新增\",\n        update: \"编辑\"\n      },\n      dataForm: {\n        id: 0,\n        userId: 0,\n        username: \"\",\n        password: \"\",\n        avatar: \"\",\n        mobile: \"\",\n        email: \"\",\n        status: 1,\n        account: \"\",\n        roleList: []\n      },\n      rules: {\n        username: [{\n          required: true,\n          message: \"用户名不能为空\"\n        }, {\n          max: 30,\n          message: \"最多输入 30 个字符\",\n          trigger: \"blur\"\n        }],\n        password: [{\n          required: true,\n          message: \"密码不能为空\"\n        }, {\n          max: 50,\n          message: \"最多输入 50 个字符\",\n          trigger: \"blur\"\n        }],\n        realName: [{\n          max: 30,\n          message: \"最多输入 30 个字符\",\n          trigger: \"blur\"\n        }],\n        phone: [{\n          required: true,\n          trigger: \"blur\",\n          validator: idValidatePhone\n        }, {\n          max: 20,\n          message: \"最多输入 20 个字符\",\n          trigger: \"blur\"\n        }],\n        email: [{\n          required: true,\n          trigger: \"blur\",\n          validator: idValidateEmail\n        }, {\n          max: 50,\n          message: \"最多输入 50 个字符\",\n          trigger: \"blur\"\n        }]\n      }\n    };\n  },\n  watch: {\n    dialogFormVisible: function dialogFormVisible(val) {\n      // 监听父元件中传来的dialogFormVisible属性是否变化，变化则赋值给副本myVisible\n      this.myVisible = val;\n    },\n    myVisible: function myVisible(val) {\n      // 修改父元件的值\n      this.$emit(\"update:dialogFormVisible\", val);\n    }\n  },\n  created: function created() {//  this.selectList()\n  },\n  methods: {\n    selectList: function selectList(id) {\n      var _this = this;\n\n      this.dataForm.id = id;\n      this.dataForm.userId = id;\n      this.roleListDataList = [];\n      fetchRoleList().then(function (response) {\n        for (var i = 0; i < response.data.data.length; i++) {\n          _this.roleListDataList.push({\n            key: response.data.data[i].roleId,\n            label: response.data.data[i].roleName\n          });\n        }\n      }).then(function () {\n        _this.myVisible = true;\n\n        _this.$nextTick(function () {\n          _this.handleCreate = [];\n\n          _this.$refs[\"dataForm\"].resetFields();\n        });\n      }).then(function () {\n        if (!_this.dataForm.id) {\n          _this.disabledInput = false;\n          _this.roleListDataByid = [];\n\n          _this.resetDataForm();\n\n          _this.imageUrl = _this.head_Png;\n        } else {\n          _this.disabledInput = true; // 修改\n\n          getUserInfo(_this.dataForm.id).then(function (response) {\n            if (response.data && response.data.code === \"200\") {\n              var data = response.data.data;\n              _this.dataForm.username = data.user.username; // this.dataForm.avatar = data.avatar;\n\n              _this.dataForm.mobile = data.user.mobile;\n              _this.dataForm.email = data.user.email;\n              _this.dataForm.status = data.user.status; // this.dataForm.account = data.account;\n\n              _this.roleListDataByid = data.roleList;\n              _this.checkListData = _this.roleListDataByid; // if(data.avatar!=null && data.avatar!=\"\"){\n              //   this.imageUrl = \"data:image/jpg;base64,\" + data.avatar;\n              // }else{\n\n              _this.imageUrl = _this.head_Png; // }\n\n              _this.dataForm.password = \"\";\n            }\n          });\n        }\n      });\n    },\n    roleChanges: function roleChanges(row) {\n      this.checkListData = this.roleListDataByid;\n    },\n    resetDataForm: function resetDataForm() {\n      this.dataForm = {\n        id: 0,\n        username: \"\",\n        password: \"\",\n        realName: \"\",\n        avatar: \"\",\n        phone: \"\",\n        email: \"\",\n        sex: \"\",\n        status: 1,\n        account: \"\",\n        roleIdList: []\n      };\n    },\n    dataFormSubmit: function dataFormSubmit() {\n      var _this2 = this;\n\n      this.$refs[\"dataForm\"].validate(function (valid) {\n        if (valid) {\n          if (!_this2.dataForm.id) {\n            _this2.dataForm.roleIdList = _this2.checkListData;\n\n            _this2.$confirm(\"确定进行[新增]操作?\", \"提示\", {\n              type: \"warning\"\n            }).then(function (response) {\n              _this2.$loading.open();\n\n              addUser(_this2.dataForm).then(function (response) {\n                if (response.data.state == \"true\") {\n                  var callback = function callback() {\n                    _this2.myVisible = false;\n\n                    _this2.$emit(\"refreshDataList\");\n                  };\n\n                  _this2.$msg.showSuccess(\"新增成功\", callback);\n                } else {\n                  _this2.$msg.showError(1, response.data.msg);\n\n                  _this2.$loading.close();\n                }\n              });\n            });\n          } else {\n            _this2.dataForm.roleIdList = _this2.checkListData;\n\n            _this2.$confirm(\"确定进行[编辑]操作?\", \"提示\", {\n              type: \"warning\"\n            }).then(function (response) {\n              _this2.$loading.open();\n\n              updUser(_this2.dataForm).then(function (response) {\n                _this2.myVisible = false;\n\n                _this2.$nextTick(function () {\n                  var _this3 = this;\n\n                  if (response.data.state == \"true\") {\n                    var callback = function callback() {\n                      _this3.myVisible = false;\n\n                      _this3.$emit(\"refreshDataList\");\n\n                      if (_this3.$store.getters.username == _this3.dataForm.username) {\n                        _this3.$store.commit(\"SET_AVATAR\", _this3.dataForm.avatar);\n\n                        _this3.$store.commit('set_user', data.data);\n                      }\n                    };\n\n                    this.$msg.showSuccess(\"编辑成功\", callback);\n                    this.$loading.close();\n                  } else {\n                    this.$msg.showError(1, response.data.msg);\n                    this.$loading.close();\n                  }\n                });\n              });\n            });\n          }\n        } else {}\n      });\n    },\n    handleCancel: function handleCancel() {\n      // 点击叉叉\n      var self = this;\n      self.myVisible = false;\n    },\n    handleAvatarSuccess: function handleAvatarSuccess(res, file) {\n      this.imageUrl = URL.createObjectURL(file.raw);\n    },\n    beforeAvatarUpload: function beforeAvatarUpload(file) {\n      var isJPG = file.type === \"image/jpeg\";\n      var isPNG = file.type === \"image/png\";\n      var isLt2M = file.size / 1024 / 1024 < 1;\n\n      if (!isJPG && !isPNG) {\n        this.$msg.showError(1, \"上传头像图片 只能是JPG 格式 或者 png格式!\");\n        return;\n      }\n\n      if (!isLt2M) {\n        this.$msg.showError(1, \"上传头像图片大小不能超过 1MB!\");\n        return;\n      }\n\n      this.uploadFile(file);\n      return isJPG && isLt2M;\n    },\n    uploadFile: function uploadFile(file) {\n      var formData = new FormData();\n      formData.append(\"file\", file); // uploadPicture(formData).then(response => {\n      //   if (response.data.state === \"true\") {\n      //     this.imageUrl = \"data:image/jpg;base64,\" + response.data.msg;\n      //     this.dataForm.avatar = response.data.msg;\n      //     this.$msg.showSuccess(\"上传成功\");\n      //   } else {\n      //     this.$msg.showError(1, response.data.msg);\n      //   }\n      // });\n    }\n  }\n};",{"version":3,"sources":["edit_user.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <el-dialog width=\"60%\" :title=\"!dataForm.id ? '用户新增' : '用户编辑'\" :visible=\"myVisible\" :before-close=\"handleCancel\" :close-on-click-modal=false>\r\n    <el-form :rules=\"rules\" ref=\"dataForm\" :model=\"dataForm\" label-position=\"right\" label-width=\"100px\" style='margin:20px;'>\r\n      <el-row>\r\n        <el-col :span=\"16\">\r\n          <el-tabs type=\"border-card\" style=\"height:380px\">\r\n            <el-tab-pane label=\"用户基本信息\">\r\n              <el-form-item label=\"账号\" prop=\"username\">\r\n                <el-input placeholder=\"请填写账号\" v-bind:disabled=\"disabledInput\" v-model.trim=\"dataForm.username\"></el-input>\r\n              </el-form-item>\r\n              <el-form-item label=\"密码\" prop=\"password\" v-if=\"!dataForm.id\">\r\n                <el-input type=\"password\" placeholder=\"请填写密码\" v-model.trim=\"dataForm.password\"></el-input>\r\n              </el-form-item>\r\n              <el-form-item label=\"密码\" v-else>\r\n                <el-input type=\"password\" placeholder=\"请输入修改后的密码\" v-model.trim=\"dataForm.password\"></el-input>\r\n              </el-form-item>\r\n              <el-form-item label=\"账户状态\">\r\n                <el-radio-group v-model=\"dataForm.status\">\r\n                  <el-radio class=\"radio\" :label=\"1\">正常</el-radio>\r\n                  <el-radio class=\"radio\" :label=\"2\">锁定</el-radio>\r\n                  <!-- <el-radio class=\"radio\" :label=\"3\">删除</el-radio>\r\n                  <el-radio class=\"radio\" :label=\"4\">非法</el-radio> -->\r\n                </el-radio-group>\r\n              </el-form-item>\r\n              <el-form-item label=\"手机号码\" prop=\"mobile\">\r\n                <el-input placeholder=\"请填写手机号码\" v-model=\"dataForm.mobile\"></el-input>\r\n              </el-form-item>\r\n              <el-form-item label=\"邮箱\" prop=\"email\">\r\n                <el-input placeholder=\"请填写邮箱\" v-model=\"dataForm.email\"></el-input>\r\n              </el-form-item>\r\n            </el-tab-pane>\r\n          </el-tabs>\r\n        </el-col>\r\n        <el-col :span=\"8\">\r\n          <el-tabs type=\"border-card\" style=\"height:380px\">\r\n            <el-tab-pane label=\"上传头像\">\r\n              <el-form ref=\"dataForm\" :model=\"dataForm\" >\r\n                <el-upload class=\"avatar-uploader\" action=\"\" :show-file-list=\"false\" :on-success=\"handleAvatarSuccess\" :before-upload=\"beforeAvatarUpload\">\r\n                  <img v-if=\"imageUrl\" :src=\"imageUrl\" class=\"avatar\">\r\n                  <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n                </el-upload>\r\n              </el-form>\r\n            </el-tab-pane>\r\n          </el-tabs>\r\n        </el-col>\r\n      </el-row>\r\n      <el-row>\r\n        <el-col :span=\"24\">\r\n          <!-- <el-form-item label=\"角色\"> -->\r\n          <el-card class=\"box-card\">\r\n            <div class=\"text item\">\r\n              <el-form-item label=\"角色\">\r\n                <el-checkbox-group v-model=\"roleListDataByid\">\r\n                  <el-checkbox v-for=\"city in roleListDataList\" :label=\"city.key\" :key=\"city.key\" @change=\"roleChanges\">{{city.label}}</el-checkbox>\r\n                </el-checkbox-group>\r\n              </el-form-item>\r\n            </div>\r\n          </el-card>\r\n          <!-- </el-form-item> -->\r\n        </el-col>\r\n      </el-row>\r\n\r\n    </el-form>\r\n    <div slot=\"footer\" class=\"dialog-footer\">\r\n      <el-button @click=\"myVisible = false\">取消</el-button>\r\n      <!-- <el-button v-if=\"dialogStatus=='create'\" type=\"primary\" @click=\"createData\">保存</el-button> -->\r\n      <el-button type=\"primary\" @click=\"dataFormSubmit\">保存</el-button>\r\n    </div>\r\n  </el-dialog>\r\n</template>\r\n\r\n<script>\r\nimport { isMobile, isEmail } from \"@/utils/validate\";\r\nimport {\r\n  addUser,\r\n  updUser,\r\n  getUserInfo\r\n  // uploadPicture\r\n} from \"@/api/auth/user\";\r\n// import { insertUserRole } from \"@/api/auth/roleUser\";\r\nimport { fetchRoleList } from \"@/api/auth/role\";\r\nimport head_Png from \"@/assets/default_head_title.png\";\r\n\r\nexport default {\r\n  props: [\"dialogStatus\", \"dialogFormVisible\"],\r\n  data() {\r\n    const idValidatePhone = (rule, value, callback) => {\r\n      if (!isMobile(value)) {\r\n        callback(new Error(\"请输入正确的手机号码\"));\r\n      } else {\r\n        callback();\r\n      }\r\n    };\r\n    const idValidateEmail = (rule, value, callback) => {\r\n      if (!isEmail(value)) {\r\n        callback(new Error(\"请输入正确的邮箱号码\"));\r\n      } else {\r\n        callback();\r\n      }\r\n    };\r\n    return {\r\n       head_Png,\r\n      myVisible: this.dialogFormVisible,\r\n      disabledInput: false,\r\n      imageUrl: '',\r\n      roleListDataList: [],\r\n      roleListDataByid: [],\r\n      checkListData: [],\r\n      statusMap: {\r\n        create: \"新增\",\r\n        update: \"编辑\"\r\n      },\r\n      dataForm: {\r\n        id: 0,\r\n        userId:0,\r\n        username: \"\",\r\n        password: \"\",\r\n        avatar: \"\",\r\n        mobile: \"\",\r\n        email: \"\",\r\n        status: 1,\r\n        account: \"\",\r\n        roleList: []\r\n      },\r\n      rules: {\r\n        username: [\r\n          { required: true, message: \"用户名不能为空\" },\r\n          { max: 30, message: \"最多输入 30 个字符\", trigger: \"blur\" }\r\n        ],\r\n        password: [\r\n          { required: true, message: \"密码不能为空\" },\r\n          { max: 50, message: \"最多输入 50 个字符\", trigger: \"blur\" }\r\n        ],\r\n        realName: [{ max: 30, message: \"最多输入 30 个字符\", trigger: \"blur\" }],\r\n        phone: [\r\n          { required: true, trigger: \"blur\", validator: idValidatePhone },\r\n          { max: 20, message: \"最多输入 20 个字符\", trigger: \"blur\" }\r\n        ],\r\n        email: [\r\n          { required: true, trigger: \"blur\", validator: idValidateEmail },\r\n          { max: 50, message: \"最多输入 50 个字符\", trigger: \"blur\" }\r\n        ]\r\n      }\r\n    };\r\n  },\r\n  watch: {\r\n    dialogFormVisible(val) {\r\n      // 监听父元件中传来的dialogFormVisible属性是否变化，变化则赋值给副本myVisible\r\n      this.myVisible = val;\r\n    },\r\n    myVisible(val) {\r\n      // 修改父元件的值\r\n      this.$emit(\"update:dialogFormVisible\", val);\r\n    }\r\n  },\r\n  created() {\r\n    //  this.selectList()\r\n  },\r\n  methods: {\r\n    selectList(id) {\r\n      this.dataForm.id = id;\r\n      this.dataForm.userId = id;\r\n      this.roleListDataList = [];\r\n      fetchRoleList()\r\n        .then(response => {\r\n          for (let i = 0; i < response.data.data.length; i++) {\r\n            this.roleListDataList.push({\r\n              key: response.data.data[i].roleId,\r\n              label: response.data.data[i].roleName\r\n            });\r\n          }\r\n        })\r\n        .then(() => {\r\n          this.myVisible = true;\r\n          this.$nextTick(() => {\r\n            this.handleCreate = [];\r\n            this.$refs[\"dataForm\"].resetFields();\r\n          });\r\n        })\r\n        .then(() => {\r\n          if (!this.dataForm.id) {\r\n            this.disabledInput = false;\r\n            this.roleListDataByid = [];\r\n            this.resetDataForm();\r\n            this.imageUrl = this.head_Png\r\n          } else {\r\n            this.disabledInput = true;\r\n            // 修改\r\n            getUserInfo(this.dataForm.id).then(response => {\r\n              if (response.data && response.data.code === \"200\") {\r\n                var data = response.data.data;\r\n                this.dataForm.username = data.user.username;\r\n                // this.dataForm.avatar = data.avatar;\r\n                this.dataForm.mobile = data.user.mobile;\r\n                this.dataForm.email = data.user.email;\r\n                this.dataForm.status = data.user.status;\r\n                // this.dataForm.account = data.account;\r\n                this.roleListDataByid = data.roleList;\r\n                this.checkListData = this.roleListDataByid;\r\n                // if(data.avatar!=null && data.avatar!=\"\"){\r\n                //   this.imageUrl = \"data:image/jpg;base64,\" + data.avatar;\r\n                // }else{\r\n                  this.imageUrl = this.head_Png\r\n                // }\r\n                this.dataForm.password = \"\";\r\n              }\r\n            });\r\n          }\r\n        });\r\n    },\r\n    roleChanges(row) {\r\n      this.checkListData = this.roleListDataByid;\r\n    },\r\n    resetDataForm() {\r\n      this.dataForm = {\r\n        id: 0,\r\n        username: \"\",\r\n        password: \"\",\r\n        realName: \"\",\r\n        avatar: \"\",\r\n        phone: \"\",\r\n        email: \"\",\r\n        sex: \"\",\r\n        status: 1,\r\n        account: \"\",\r\n        roleIdList: []\r\n      };\r\n    },\r\n    dataFormSubmit() {\r\n      this.$refs[\"dataForm\"].validate(valid => {\r\n        if (valid) {\r\n          if (!this.dataForm.id) {\r\n            this.dataForm.roleIdList = this.checkListData;\r\n            this.$confirm(\"确定进行[新增]操作?\", \"提示\", {\r\n              type: \"warning\"\r\n            }).then(response => {\r\n             this.$loading.open();\r\n              addUser(this.dataForm).then(response => {\r\n                if (response.data.state == \"true\") {\r\n                  let callback = () => {\r\n                    this.myVisible = false;\r\n                    this.$emit(\"refreshDataList\");\r\n                  };\r\n                  this.$msg.showSuccess(\"新增成功\", callback);\r\n                } else {\r\n                  this.$msg.showError(1, response.data.msg);\r\n                  this.$loading.close();\r\n                }\r\n              });\r\n            });\r\n          } else {\r\n            this.dataForm.roleIdList = this.checkListData;\r\n            this.$confirm(\"确定进行[编辑]操作?\", \"提示\", {\r\n              type: \"warning\"\r\n            }).then(response => {\r\n              this.$loading.open();\r\n              updUser(this.dataForm).then(response => {\r\n                this.myVisible = false;\r\n                this.$nextTick(function() {\r\n                  if (response.data.state == \"true\") {\r\n                    let callback = () => {\r\n                      this.myVisible = false;\r\n                      this.$emit(\"refreshDataList\");\r\n                      if (\r\n                        this.$store.getters.username == this.dataForm.username\r\n                      ) {\r\n                        this.$store.commit(\"SET_AVATAR\", this.dataForm.avatar);\r\n                        this.$store.commit('set_user', data.data);\r\n                      }\r\n                    };\r\n                    this.$msg.showSuccess(\"编辑成功\", callback);\r\n                    this.$loading.close();\r\n                  } else {\r\n                    this.$msg.showError(1, response.data.msg);\r\n                    this.$loading.close();\r\n                  }\r\n                });\r\n              });\r\n            });\r\n          }\r\n        } else {\r\n        }\r\n      });\r\n    },\r\n    handleCancel() {\r\n      // 点击叉叉\r\n      var self = this;\r\n      self.myVisible = false;\r\n    },\r\n    handleAvatarSuccess(res, file) {\r\n      this.imageUrl = URL.createObjectURL(file.raw);\r\n    },\r\n    beforeAvatarUpload(file) {\r\n      const isJPG = file.type === \"image/jpeg\";\r\n      const isPNG = file.type === \"image/png\";\r\n      const isLt2M = file.size / 1024 / 1024 < 1;\r\n\r\n      if (!isJPG && !isPNG) {\r\n        this.$msg.showError(1, \"上传头像图片 只能是JPG 格式 或者 png格式!\");\r\n        return;\r\n      }\r\n      if (!isLt2M) {\r\n        this.$msg.showError(1, \"上传头像图片大小不能超过 1MB!\");\r\n        return;\r\n      }\r\n      this.uploadFile(file);\r\n      return isJPG && isLt2M;\r\n    },\r\n    uploadFile(file) {\r\n      const formData = new FormData();\r\n      formData.append(\"file\", file);\r\n      // uploadPicture(formData).then(response => {\r\n      //   if (response.data.state === \"true\") {\r\n      //     this.imageUrl = \"data:image/jpg;base64,\" + response.data.msg;\r\n      //     this.dataForm.avatar = response.data.msg;\r\n      //     this.$msg.showSuccess(\"上传成功\");\r\n      //   } else {\r\n      //     this.$msg.showError(1, response.data.msg);\r\n      //   }\r\n      // });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.avatar-uploader .el-upload {\r\n  border: 1px dashed #d9d9d9;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n.avatar-uploader .el-upload:hover {\r\n  border-color: #409eff;\r\n}\r\n.avatar-uploader-icon {\r\n  font-size: 28px;\r\n  color: #8c939d;\r\n  width: 178px;\r\n  height: 178px;\r\n  line-height: 178px;\r\n  text-align: center;\r\n  padding-top: 60px;\r\n}\r\n.avatar {\r\n  width: 178px;\r\n  height: 178px;\r\n  display: block;\r\n}\r\n</style>\r\n\r\n"],"sourceRoot":"src/views/auth/user"}]}